"use strict";!function(l){function t(){this.$usernamebox=l(".sn-login"),this.$hidebox=l(".sn-register"),this.$moban=l(".goods-info"),this.$itembox=l(".goods-item"),this.$goodsnums=l(".goodsnums"),this.$totalprice=l(".totalprice"),this.$selectallbtn=l(".selectbtn-all"),this.init()}t.prototype.init=function(){this.getcookie("username")&&(this.$usernamebox.html(this.getcookie("username").split("; ")[0]),this.$usernamebox.attr("href","#"),this.$hidebox.html("退出"),this.$hidebox.attr("href","#"),this.$hidebox.on("click",function(){return t.$usernamebox.html("请登录"),t.$usernamebox.attr("href","http://10.31.158.21:8088/tianmao/object/src/login.html"),t.$hidebox.html("免费注册"),t.$hidebox.attr("href","http://10.31.158.21:8088/tianmao/object/src/registor.html"),t.removecookie("username"),!1}));var t=this;this.getcookie("cookieid")&&this.senddata(),this.have(),this.$upbtn=l(".quantity-add"),this.$downbtn=l(".quantity-down"),this.$upbtn.on("click",function(){t.jjbtn(l(this),999,1)}),this.$downbtn.on("click",function(){t.jjbtn(l(this),1,-1)}),this.delcar(),this.$selectallbtn.on("click",function(){t.selectall()}),this.select()},t.prototype.senddata=function(){var c=this;this.cookiedata=this.getcookie("cookieid").split(",");var n=0,s=0;l.each(this.cookiedata,function(t,e){var i=c.getcookie("cookienum").split(",")[t],o=c.getcookie("cookietable").split(",")[t];l.ajax({async:!1,url:"http://10.31.158.21:8088/tianmao/object/php/car.php?id="+e+"&table="+o,dataType:"json"}).done(function(t){var e=c.$moban.clone();e.find(".del-btn").attr("dataid",t.id),e.css("display","block"),e.find(".data-title").html(t.title),e.find(".data-price").html((+t.price).toFixed(2)),e.find(".data-url").attr("src",t.url),e.find(".cookie-num").attr("value",i).attr("uid",t.id).attr("table",t.table),e.find(".price-all").html((i*t.price).toFixed(2)),c.$itembox.prepend(e),n+=+t.price*+i,s++,c.$totalprice.html(n.toFixed(2)),c.$goodsnums.html(s)})})},t.prototype.have=function(){this.$carttop=l(".empty-cart"),this.$cartwrap=l(".cart-wrap"),this.$carttop.css("display","none"),this.getcookie("cookieid")?(this.$carttop.css("display","none"),this.$cartwrap.css("display","block")):(this.$carttop.css("display","block"),this.$cartwrap.css("display","none"))},t.prototype.delcar=function(){var e=this;l(".del-btn").on("click",function(){var t=+l(this).parent().siblings(".b-sum").find(".price-all").html();e.cookiechange(l(this).attr("dataid")),l(this).parent().parent().remove(),e.$totalprice.html(+e.$totalprice.html()-t),e.$goodsnums.html(+e.$goodsnums.html()-1)})},t.prototype.jjbtn=function(o,t,e){var c=this,n=o.parent().parent().find(".cookie-num"),s=o.parent().parent().siblings(".b-sum").find(".price-all"),a=+s.html();n.val()==t?n.val(t):(n.val(+n.val()+e),l.get("http://10.31.158.21:8088/tianmao/object/php/car.php",{id:n.attr("uid"),table:n.attr("table")},function(t){var e=0;e+=+(t=JSON.parse(t)).price*+n.val(),s.html(e.toFixed(2));var i=+o.parent().parent().siblings(".b-sum").find(".price-all").html()-a;c.$totalprice.html((+c.$totalprice.html()+i).toFixed(2))}),this.cookiechange(n.attr("uid"),e))},t.prototype.selectall=function(){this.$selectbtn=l(".selectbtn-one"),this.$selectbtn.prop("checked")?(this.$selectbtn.prop("checked",!1),this.$selectallbtn.prop("checked",!1)):(this.$selectbtn.prop("checked",!0),this.$selectallbtn.prop("checked",!0)),this.dataup()},t.prototype.select=function(){var t=this;this.$selectbtn=l(".selectbtn-one"),this.$selectbtn.on("click",function(){t.$selectbtn.length===l(".selectbtn-one:checked").length?t.$selectallbtn.prop("checked",!0):t.$selectallbtn.prop("checked",!1),t.dataup()})},t.prototype.dataup=function(){var o=0,c=0;l(".selectbtn-one:checked:visible").each(function(t,e){console.log(e),c++;var i=+l(e).parent().parent().siblings(".b-sum").find(".price-all").html();o+=i,console.log(i)}),this.$totalprice.html(o.toFixed(2)),this.$goodsnums.html(c)},t.prototype.cookiechange=function(t,e){var i=this,o=i.getcookie("cookieid").split(",").indexOf(t),c=i.getcookie("cookieid").split(","),n=i.getcookie("cookienum").split(","),s=i.getcookie("cookietable").split(",");e?(n.splice(o,1,+n[o]+e),i.setcookie("cookienum",n,7)):(c.splice(o,1),n.splice(o,1),s.splice(o,1),i.setcookie("cookieid",c,7),i.setcookie("cookienum",n,7),i.setcookie("cookietable",s,7))},t.prototype.setcookie=function(t,e,i){var o=new Date;o.setDate(o.getDate()+i),document.cookie=t+"="+e+";expires="+o},t.prototype.getcookie=function(t){for(var e=document.cookie.split("; "),i=0;i<e.length;i++){var o=e[i].split("=");if(o[0]===t)return o[1]}},t.prototype.removecookie=function(t){this.setcookie(t,"",-1)},new t}(jQuery);